<!DOCTYPE html>
<html>

<head>
  <title>List Pertandingan</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    h2 {
      text-align: center;
      margin-top: 20px;
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
    }

    button {
      padding: 6px 10px;
      font-size: 14px;
    }

    .notification {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: #f0f0f0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 9999;
    }
  </style>
</head>

<body>
  <div id="myNotification" class="notification">
    <p>This is a pop-up notification!</p>
  </div>

  <h2>LIST PERTANDINGAN</h2>
  <table>
    <thead>
      <tr>
        <th>Grup A</th>
        <th>Action</th>
        <th>Grup B</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="grupa1">{{pertandingans.0.1}} vs {{pertandingans.1.1}}</td>
        <td id="action1"></td>
        <td id="grupb1">{{pertandingans.8.1}} vs {{pertandingans.9.1}}</td>
        <td id="action2"></td>
      </tr>
      <tr>
        <td id="grupa2">{{pertandingans.2.1}} vs {{pertandingans.3.1}}</td>
        <td id="action3"></td>
        <td id="grupb2">{{pertandingans.10.1}} vs {{pertandingans.11.1}}</td>
        <td id="action4"></td>
      </tr>
      <tr>
        <td id="grupa3">{{pertandingans.4.1}} vs {{pertandingans.5.1}}</td>
        <td id="action5"></td>
        <td id="grupb3">{{pertandingans.12.1}} vs {{pertandingans.13.1}}</td>
        <td id="action6"></td>
      </tr>
      <tr>
        <td id="grupa4">{{pertandingans.6.1}} vs {{pertandingans.7.1}}</td>
        <td id="action7"></td>
        <td id="grupb4">{{pertandingans.14.1}} vs {{pertandingans.15.1}}</td>
        <td id="action8"></td>
      </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th>Grup C</th>
        <th>Action</th>
        <th>Grup D</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="grupc1">{{pertandingans.16.1}} vs {{pertandingans.17.1}}</td>
        <td id="action9"></td>
        <td id="grupd1">{{pertandingans.24.1}} vs {{pertandingans.25.1}}</td>
        <td id="action10"></td>
      </tr>
      <tr>
        <td id="grupc2">{{pertandingans.18.1}} vs {{pertandingans.19.1}}</td>
        <td id="action11"></td>
        <td id="grupd2">{{pertandingans.26.1}} vs {{pertandingans.27.1}}</td>
        <td id="action12"></td>
      </tr>
      <tr>
        <td id="grupc3">{{pertandingans.20.1}} vs {{pertandingans.21.1}}</td>
        <td id="action13"></td>
        <td id="grupd3">{{pertandingans.28.1}} vs {{pertandingans.29.1}}</td>
        <td id="action14"></td>
      </tr>
      <tr>
        <td id="grupc4">{{pertandingans.22.1}} vs {{pertandingans.23.1}}</td>
        <td id="action15"></td>
        <td id="grupd4">{{pertandingans.30.1}} vs {{pertandingans.31.1}}</td>
        <td id="action16"></td>
      </tr>
    </tbody>
  </table>

  <script>
    // Get the team cells and action cells
    var teamCells = document.querySelectorAll('td[id^="grupa"], td[id^="grupb"], td[id^="grupc"], td[id^="grupd"]');
    var actionCells = document.querySelectorAll('td[id^="action"]');
    // Get list of pertandingans from the server
    var pertandingans_json = JSON.parse('{{ pertandingans_json|safe|escapejs }}');


    // Loop through each team cell and update the action cell accordingly
    for (var i = 0; i < teamCells.length; i++) {
      var teamCell = teamCells[i];
      var actionCell = actionCells[i];

      // Check if the team cell contains '? vs ?'
      if (teamCell.innerHTML.trim() === '? vs ?') {
        // Create an 'Add' button and set it as the content of the action cell
        var addButton = document.createElement('button');
        addButton.textContent = 'Add';
        actionCell.appendChild(addButton);
      } else {
        // Create an 'Update' button and set it as the content of the action cell
        var updateButton = document.createElement('button');
        updateButton.textContent = 'Update';
        actionCell.appendChild(updateButton);

        // Add click event listener to the update button
        updateButton.addEventListener('click', function () {
          // Redirect to the desired page
          window.location.href = '/pembuatan_pertandingan/buat_pertandingan';
        });

        // Create a 'Delete' button and set it as the content of the action cell
        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        actionCell.appendChild(deleteButton);

        // Add click event listener to the delete button
        deleteButton.addEventListener('click', function () {

          var row = this.parentNode.parentNode;
          var groupId = row.querySelector('td[id^="grupa"]');
          var groupAction = row.querySelector('td[id^="action"]');
          console.log('delete clicked')

          var xhr = new XMLHttpRequest();
          xhr.open('DELETE','/delete_pertandingan/' + pertandingans_json[0].substring(7,43) + '/', true);
          console.log(pertandingans_json[0].substring(7,43))
          console.log(pertandingans_json[0])

          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          
          xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
              console.log(xhr.status);
              if (xhr.status === 200) {
                // create pop up message
                groupId.innerHTML = '? vs ?';

              } else {
                // Handle the error condition
                var notification = document.getElementById("myNotification");
                notification.style.display = "block";

                // Hide the notification after 3 seconds
                setTimeout(function () {
                  notification.style.display = "Gagal menghapus pertandingan";
                }, 3000);
              }
            }
          };
          xhr.send();
        });
      }
    }
  </script>
</body>

</html>